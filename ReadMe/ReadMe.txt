----------------------------------------------------------------------
                                                   2009 年 05 月 24 日

                   Yomi-Search(PHP)modified Ver1.5.8

目次
====

01. 利用規約など
02. Yomi-Search(PHP)modifiedとは
03. インストール方法
04. 旧バージョンからのアップデート方法
05. デバッグモードについて
06. 関連リンク
07. バージョンアップ履歴

----------------------------------------------------------------------


01. 利用規約など
================

本スクリプトはYomi-SearchPHP化プロジェクトで配布されている
Yomi-Search(PHP)Ver4.19.5をベースに、多くの改造を施した改造版
Yomi-Search(PHP)です。

したがって、利用規約はYomi-SearchPHP化プロジェクトの規約に準ずるものと
します。



02. Yomi-Search(PHP)modifiedとは
================================

WonderLinkのyomi氏によって開発されたYomi-Searchという検索エンジンスク
リプトがあります。これが非常に高機能かつ使いやすいということで、多くの
サイト管理者が自サイトにYomi-Searchを導入しました。

後に、このYomi-SearchをPHPで書き直したYomi-Search(PHP)が登場します。こ
のPHP版ではデータの保存にMySQLデータベースを使用し、高速な検索を実現し
ています。

本スクリプト[Yomi-Search(PHP)modified]は、上記Yomi-Search(PHP)の最新版
であるVer4.19.5をベースに、機能追加やバグ除去などの大幅な改造を施した
検索エンジンスクリプトです。



03. インストール方法
====================

03-01. データベースに関する設定
-------------------------------
class/db.phpを開き、4行目～10行目のデータベースに関する設定を行ってく
ださい。

＜注意 2010/10/15追加＞
データベースで$db_pre +「key」というテーブル名を使用しています。そのため
$db_preを空文字に設定するとテーブル名が「key」のみとなり
keyはMySQLの予約語なのでそのままテーブル名とするとエラーとなってしまいます。
http://dev.mysql.com/doc/refman/5.1/ja/reserved-words.html
そのため、$db_preには半角スペース、半角記号以外の文字を1文字以上設定してください。


03-02. ファイルのアップロードとディレクトリの権限設定
-----------------------------------------------------
ReadMe.txtとChangeLog.txt以外のファイルをサーバへアップロード後、logデ
ィレクトリのパーミッション(アクセス権限)を777、logディレクトリ内の
look_mes.cgiとpass_check.cgiのパーミッションを666に設定。

03-03. セットアップスクリプトの実行
-----------------------------------
ブラウザから http://設置したURL/setup/setup.php にアクセスすることでイ
ンストールプログラムを実行します。後は、画面の指示に従ってインストール
を完了させてください。

03-04. setupディレクトリの削除
------------------------------
インストールが完了したら、まずサーバ上のsetupディレクトリ以下を削除し
てください。これらのファイルが残ったままになっていると、悪意ある第三者
に検索エンジンの管理者パスワードを変更されてしまう可能性があります。



04. 旧バージョンからのアップデート方法
==============================================

04-01. ver1.2以降 -> ver1.5.8
-----------------------------
基本的には全てのファイルを上書きするだけでOKです。ただし、上書きするだ
けではバージョン情報が変更されませんので、気になる方はphpMyAdminを使用
する等して、cfgテーブルの内容を変更してください。

なおver1.5.8から[html]ディレクトリ並びに[pl]ディレクトリは廃止されまし
た。元々PHP版では使用されていないフォルダ(本家Perl版の遺産)ですので、
該当ディレクトリがサーバ上に残っている場合には削除してください。

04-02. ver1.1 -> ver1.5.8
-------------------------
基本的には全てのファイルを上書きするだけでOKです。ただし、上書きするだ
けではバージョン情報が変更されませんので、気になる方はphpMyAdminを使用
する等して、cfgテーブルの内容を変更してください。

なおver1.5.8から[html]ディレクトリ並びに[pl]ディレクトリは廃止されまし
た。元々PHP版では使用されていないフォルダ(本家Perl版の遺産)ですので、
該当ディレクトリがサーバ上に残っている場合には削除してください。

ver1.2以降ではメタ検索に使用する外部検索エンジンの内、正常に機能してい
ない部分を削除しています。

これに伴い、管理室内の[HTMLの設定]->[外部検索エンジンの設定]の設定を下
記の様に変更する必要があります。

※注意※
1行目の「サイト名」部分はご自身のサイト名に置き換えてください。

<option value="pre" selected>サイト名
<option value="yahoo">Yahoo!
<option value="google">Google
<option value="infoseek">Infoseek
<option value="goo">goo
<option value="excite">Excite
<option value="FRESHEYE">フレッシュアイ
<option value="">-----------------
<option value="vector">Vector
<option value="">-----------------
<option value="rakuten">楽天市場
<option value="hmv_a">HMV(アーティスト名検索)
<option value="hmv_t">HMV(タイトル名検索)
<option value="bk1">bk1
<option value="">-----------------
<option value="com">.com
<option value="cojp">.co.jp
<option value="jp">.jp で</option>
<option value="net">.netで</option>
<option value="info">.infoで</option>
<option value="org">.orgで</option>
<option value="movi">.moviで</option>


05. デバッグモードについて
==========================

改造を施す場合など、NOTICEを含む全てのエラーを表示させたい場合には
config4debug.phpを1箇所変更するだけでデバッグモードに移行できます。

この場合には、5行目の値を1に変更して上書きアップロードしてください。



06. 関連リンク
==============

■WonderLink
http://yomi.pekori.to/
本家Yomi-Searchの開発元サイト。検索エンジン以外にも多くのスクリプトが
フリーで配布されています。

■Yomi-Search PHP化プロジェクト
http://sql.s28.xrea.com/
Yomi-Search(PHP)の開発元です。2005年8月2日以降、開発が停止しています。

■Yomi-Search(PHP) Support Forum
http://yomi.php.jp-search.net/
Yomi-Search(PHP)に関するフォーラムです。設置やバグに関する情報が数多く
蓄積されています。

■Yomi-Search(PHP)modified
http://yomiphp-mod.sweet82.com/
本スクリプト[Yomi-Search(PHP)modified]の開発元。



07. バージョンアップ履歴
========================

2007/03/08
----------
・ver0.1 配布開始。
・Yomi-Search(PHP)Ver4.19.5 をベースに完全UTF8化し、マイリンク機能を標
　準で搭載した。

2007/03/21
----------
・ver1.0 配布開始。
・管理画面を全面改装し、特殊カテゴリ(マーク)を3個から10個に拡張。特殊
　カテゴリ用の管理画面も追加。

2007/04/01
----------
・ver1.1 配布開始。
・インストール方法を記述したReadMe.txtを追加。
・IEでマイリンクにアクセスした場合に、バナー画像が表示されないというバ
　グを修正。
・人気ランキング機能をOFFにした場合に、登録サイトへジャンプできなくな
　るというバグを修正。
・PHP5を利用しているサーバに設置した場合に、表示順の変更ができなくなる
　というバグを修正。
・管理画面の[ユーザ報告のリンク切れデータ]で、処理区分を[保留]として変
　更反映ボタンをクリックした場合に、該当の報告データが削除されてしまう
　バグを修正。
・登録されたURLにアンパーサント(&)が含まれている場合に、一部のブラウザ
　で該当サイトに移動できないバグを修正。
・管理画面の[新規カテゴリ作成]部分に表示している[作成方法のサンプル]が
　間違っていたので修正。
・仮登録状態のデータを本登録する際に、マーク3～マーク10にチェックを入
　れて[登録・削除の実行]ボタンをクリックしてもマークが有効にならないバ
　グを修正。

2007/05/15
----------
・ver1.2 配布開始。
・管理画面のテンプレートに、使用できないメニューが残ったままになってい
　たので削除した。
・メタ検索に使用する外部検索エンジンの内、正しく機能していないものを削
　除した。
・テンプレートの一部を改装。
・MySQLのバージョンが4.1未満の場合、セットアップスクリプトが動作しない
　という不都合を修正。
・訪問者が新規登録を行った場合、勝手にマーク3とマーク4が有効となってし
　まうバグを修正。
・管理室からバックアップデータの復元を行なうと、logテーブルのテーブル
　構造が狂ってしまうバグを修正。
・登録審査システムを有効にした場合、承認画面に[相互リンクの有無]と[追
　加して欲しいカテゴリ]の入力状態を表示する項目が表示されないというバ
　グを修正。
・登録審査システムを有効にした場合、承認画面で「申請者へのメッセージ」
　にコメントを入力しても、申請者宛てメールにメッセージが追加されないと
　いうバグを修正。
・mail_ys.phpで定義されているsendmail関数を呼び出す際、パラメーターの
　数が合っていない為にWorningがサーバログに残ってしまうという不都合を
　修正。
・文字コードがUTF-8になったことで、登録処理時の文字数制限が正しく処理
　されなくなっていたバグを修正。
・XSS攻撃に対する脆弱性について暫定的な対処を追加。
・新規登録時に、管理室で設定した「登録禁止ワードの設定」がチェックされ
　ないバグを修正。
・ワード検索において、検索結果の2ページ目以降が正しく表示されないバグ
　を修正。

2007/06/16
----------
・ver1.3 配布開始。
・登録申請時に[キーワード][追加希望カテゴリ][管理人へのメッセージ]を記
　入しているにも関わらず、送信されたメールには記載されていないという不
　都合を修正。
・管理者に通知リンクをクリックして通知画面に移動した際に、通知対象のサ
　イト名が文字化けすることがあるという不都合を修正。
・環境設定(登録処理関連)で管理人のみが登録できるモードを有効にしても、
　管理者以外が登録できてしまうという不都合を修正。
・環境設定(登録処理関連)で「登録者のメッセージの最大保存数」に「m」を
　付けても、最大保存数に達した場合でも管理者宛てにメールが送信されない
　不都合を修正。

2007/12/03
----------
・ver1.4 配布開始
・アクセスランキングにランクインしているサイトが削除された際、削除済み
　IDからのアクセスが記録されてしまう為、ランキングの順位に欠番が発生し
　てしまう不都合を修正。
・php.iniでショートタグが無効になっていても動作するようにテンプレート
　ファイルを修正。
・スパム登録への対応として、新規登録画面に認証コード機能を導入。
・ランキングを実施しない設定で運用している際に、その旨を知らせるメッセ
　ージが表示されないという不都合を修正。

2007/12/03
----------
・ver1.4.1 配布開始
・アクセスランキングが正常に動作しない不都合を修正。
・コード認証関連のテンプレートに記述誤りがあったので修正。

2008/04/19
----------
・ver1.5.0 配布開始
・新着サイト＆更新サイトデータをRSS2.0で配信できる機能を追加。
・不都合だらけのi.phpを廃止。
・登録データ修正ページにおいて、アクセスランキングの現在ポイントが人気
　ランキングの集計期間で表示されてしまう不都合を修正。
・日付検索＋検索ワードなし＋カテゴリ名検索で全てのカテゴリが表示されて
　しまうという不都合を修正。
・CSSファイルの文字コードがEUCになっていた為に、IE6でCSSが正しく適用さ
　れていなかった不都合を修正。
・一部のテンプレートファイルに記述誤りがあったので修正。
・キーワード検索を行う際に、外部検索エンジン(Infoseek)を選択して検索す
　ると正しく検索できない不都合を修正。
・仮登録サイトを本登録処理する際に「管理人から登録者へのメッセージ」が
　送信されない不都合を修正。
・デッドリンクチェック(WWWC用)ファイルが正しく生成できていなかった不都
　合を修正。

2008/05/31
----------
・ver1.5.1 配布開始
・レンダリングエンジンにWebkitを使用しているブラウザ(Safari/シイラ等)
　において、マイリンク機能が正常に動作しなかった不都合を修正。

2008/06/22
----------
・ver1.5.2 配布開始
・functions.phpにおいて[その他のカテゴリ表示]の列数を変更した場合に、
　HTMLが正しく生成されなくなる不都合を修正。
・デバッグモードをONにした場合に表示されていたNOTICEについて、確認でき
　ている部分を修正。

2008/09/07
----------
・ver1.5.3 配布開始
・template/admin/cfg_html.html内に残っていた不要な記述を削除。
・IE6でRSSフィードのリンクをクリックした場合に、フィード内容が画面に表
　示されない不都合を修正。
・[管理室]->[カテゴリ設定]画面において、カテゴリ説明文の表示＆変更が出
　来るように修正。
・デバッグモードのデフォルト値を「0：E_NOTICEを表示しない」に変更。
・デバッグモードをONにした場合に表示されていたNOTICEについて、新たに確
　認できた部分を修正。

2009/01/02
----------
・ver1.5.4 配布開始
・template/regist_new_preview.html内に残っていたショートタグを排除し、
　正規のPHP表現に修正。

2009/01/23
----------
・ver1.5.5 配布開始
・検索結果画面において、2ページ目以降に移動できなくなっていたバグを修
　正。
・詳細検索が正常に動作しなくなっていたバグを修正。

2009/03/20
----------
・ver1.5.6 配布開始
・詳細検索において、前回バージョンアップで修正漏れがあった部分を修正。
・管理画面にてカテゴリのソートを行った場合に、登録カテゴリが予期しない
　カテゴリに変換されてしまうバグを修正。
・管理画面にてキーワードランキングの設定を行う場合に、SQL構文エラーと
　なる不都合を修正。

2009/04/24
----------
・ver1.5.7 配布開始
・本バージョンより変更を加えたファイル名を同梱の[ChangeLog.txt]に収録
　するようにしました。ご自身で改造されたYomi-Search(PHP)modifiedをアッ
　プデートする際にご活用ください。
・仮登録状態のデータを管理者が承認する際、カテゴリを変更しても変更が適
　用されないバグを修正。
・[管理室]->[カテゴリ設定]画面において、空ではないカテゴリを削除できて
　しまうという不都合を修正。
・[管理室]->[ログデータの交換・移動・削除]->[ログデータの移動]において
　移動元カテゴリと移動先カテゴリの両方を含むログが変換対象になった場合
　に、カテゴリの重複が発生してしまうという不都合を修正。
・サイトの新規登録処理においてバナー画像のチェックを強化。これに伴い、
　外部サーバーからの参照が禁止されている画像が指定された場合にはエラー
　メッセージを表示するように変更。
・サイトの新規登録処理において、キーワードを自動整形する処理を追加。こ
　れにより[・][、][　][,]が自動的に区切り文字(半角スペース)に自動変換
　されるように変更。
・php/以下のファイルについて、末尾の不要なexit命令を削除。

2009/05/24
----------
・ver1.5.8 配布開始
・一部のページでテンプレートが二重に表示されてしまう不都合を修正。
・rss/rss.phpで自動生成されるXML内のlink要素が、誤った値になっていたの
　で修正。
・php.iniでショートタグが無効になっている場合に検索を実行するとエラー
　になってしまう不都合を修正。
----------------------------------------------------------------------